# Анализ ошибки «Transaction was submitted but was not yet found on the chain»

## Описание

При пополнении (deposit) или выводе (withdraw) иногда возникает ошибка:

> Transaction with ID 7C77DABDCE777E6057A5BDCFBB11094261319345B40F200C11875738800CD548 was submitted but was not yet found on the chain. You might want to check later. There was a wait of 60 seconds.

## Откуда берётся ошибка

### Пополнение (Deposit)

Пополнение выполняется **на клиенте** через CosmJS: пользователь подписывает CW20 Send в браузере, CosmJS отправляет транзакцию в RPC и ждёт включения в блок. По умолчанию CosmJS ждёт **60 секунд**. Если за это время транзакция не появилась в блоке (по мнению RPC-ноды), выбрасывается эта ошибка.

### Вывод (Withdraw)

Вывод идёт через **relayer** на API. Relayer использует `broadcastTxSync` (мгновенная отправка в mempool) и свой опрос REST API в течение 25 секунд. Если API возвращает 504 с `CHAIN_TX_TIMEOUT`, это значит, что relayer не дождался подтверждения за 25 секунд.

## Возможные причины

1. **Задержка RPC/REST** — нода перегружена или медленно синхронизируется.
2. **Переполнение mempool** — много транзакций в очереди, ваша может ждать несколько блоков.
3. **Разные ноды** — broadcast идёт на RPC, а опрос — на REST; если это разные инстансы, они могут быть не синхронизированы.
4. **Увеличенный block time** — при сбоях сети блоки могут создаваться реже обычного.
5. **Отклонение CheckTx** — транзакция могла быть отклонена валидаторами (недостаточно gas, неверный формат и т.п.), тогда она не попадёт в блок.
6. **Проблемы с сетью** — временные сетевые сбои между клиентом и RPC.

## Важно

**Транзакция может всё равно пройти.** Ошибка означает только то, что клиент не дождался подтверждения за отведённое время. Транзакция могла:
- уже быть в mempool и попасть в следующий блок;
- уже быть включена в блок, но REST ещё не проиндексировал её.

## Что сделано для улучшения

1. **Увеличен таймаут CosmJS** — с 60 до 120 секунд для deposit (`broadcastTimeoutMs`, `wallet-signer.ts`).
2. **Ссылка на explorer** — при ошибке показывается кнопка «Проверить транзакцию» с ссылкой на axiomechain.org.
3. **Проверка баланса** — после ошибки стоит обновить страницу или подождать и проверить баланс; если транзакция прошла, средства появятся.

## Рекомендации пользователю

1. Проверить транзакцию по ссылке в explorer.
2. Подождать 1–2 минуты и обновить баланс.
3. Если транзакция не появилась в explorer — повторить операцию (средства не списались).
